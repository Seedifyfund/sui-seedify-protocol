import{S as O,g as V,r as v,j as e}from"./index-iN8fCw0q.js";import{Q as L,B as y}from"./createLucideIcon-tKRT68xa.js";import{T as $,C as B}from"./Tooltip-CzJRLxQK.js";import{T as k,a as H,b as C,c,d as q,e as o}from"./table-DjcR4Th1.js";import{S as J}from"./sidebar-dqPYJSSx.js";import{a as M}from"./axios-B4uVmeYG.js";import"./layout-Bi5imwWd.js";import"./dropdown-menu-DEEHH6DH.js";const Z=()=>{const w="http://localhost:8000/api",p=new O({url:V("testnet")}),[S,A]=v.useState([]),[D,F]=v.useState(!1),R="0x4afa11807187e5c657ffba3b552fdbb546d6e496ee5591dca919c99dd48d3f27";v.useEffect(()=>{(async()=>{try{const n=(await M.get(`${w}/vesting/getAllVesting`)).data.allVesting;console.log(n);const l=n.map(r=>r.receiver);_(l)}catch(a){console.error("Error fetching vesting data:",a)}})()},[]);const _=async t=>{try{y.info("Fetching vesting status...");const a=[];for(const n of t){const r=(await p.getOwnedObjects({owner:n,filter:{StructType:`${R}::torqueprotocol::Wallet`},options:{showType:!0,showContent:!0}})).data.filter(i=>{var d;return(d=i.data)==null?void 0:d.objectId}),x=await Promise.all(r.map(async i=>{var d;try{const m=(await p.getObject({id:i.data.objectId,options:{showContent:!0}})).data;console.log("Wallet Object:",JSON.stringify(m,null,2));const s=(d=m==null?void 0:m.content)==null?void 0:d.fields,g=await W(s.id.id),j=m.content.type.match(/<(.+)>/),h=j?j[1]:null;console.log("Extracted Wallet Type:",h);const u=await p.getCoinMetadata({coinType:h}),T=(u==null?void 0:u.name)??"";return{id:{id:s.id.id},balance:Number(s.balance)/1e9,released:Number(s.released)/1e9,duration:Number(s.duration)/(24*60*60*1e3),claim_interval:Number(s.claim_interval)/(24*60*60*1e3),last_claimed:Number(s.last_claimed),start:Number(s.start),releasable:Number(g)/1e9,walletType:h,coinName:T}}catch(f){return console.log("Error fetching wallet details:",f),null}}));a.push(...x.filter(i=>i!==null))}A(a),y.success("Vesting status fetched successfully!")}catch(a){y.error("Failed to fetch vesting status."),console.error("Failed to fetch vesting status:",a)}},W=async t=>{var a,n,l,r,x,i,d,f;try{const s=(await p.getObject({id:t,options:{showContent:!0}})).data,g=Date.now(),N=(n=(a=s==null?void 0:s.content)==null?void 0:a.fields)==null?void 0:n.start,j=(r=(l=s==null?void 0:s.content)==null?void 0:l.fields)==null?void 0:r.duration,h=(i=(x=s==null?void 0:s.content)==null?void 0:x.fields)==null?void 0:i.balance,u=(f=(d=s==null?void 0:s.content)==null?void 0:d.fields)==null?void 0:f.released;if(!N||!j||!h||!u)throw new Error("Incomplete wallet data");return E(N,j,h,u,g)}catch(m){return console.error("Failed to fetch releasable amount:",m),0}},E=(t,a,n,l,r)=>r<t?0:r>t+a?n+l:(n+l)*(r-t)/a,b=t=>(t||0).toLocaleString(void 0,{maximumFractionDigits:2}),I=t=>{if(!t)return"";const a=t.slice(0,4),n=t.slice(-5);return`${a}.....${n}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex",children:[e.jsx(J,{isCollapsed:D,setIsCollapsed:F}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto p-2 pt-10 text-white",children:[e.jsx(L,{}),e.jsx("div",{className:"justify-center items-center",children:e.jsxs("div",{className:"rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center",children:"All Vestings"}),e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(k,{className:"min-w-full text-white",children:[e.jsx(H,{children:e.jsxs(C,{children:[e.jsx(c,{children:"Wallet ID"}),e.jsx(c,{children:"Coin Name"}),e.jsx(c,{children:"Copy ID"}),e.jsx(c,{children:"Start"}),e.jsx(c,{children:"Balance"}),e.jsx(c,{children:"Released"}),e.jsx(c,{children:"Claimable Amount"}),e.jsx(c,{children:"Duration (days)"}),e.jsx(c,{children:"Claim Interval (days)"}),e.jsx(c,{children:"Last Released"})]})}),e.jsx(q,{children:S.map((t,a)=>{const n=t.releasable-t.released;return e.jsxs(C,{className:"font-bold text-white",children:[e.jsx(o,{children:I(t.id.id)}),e.jsx(o,{children:t.coinName}),e.jsx(o,{children:e.jsx("div",{className:"flex items-center",children:e.jsx($,{message:"Copy",children:e.jsx("div",{className:"flex items-center",children:e.jsx("button",{className:"ml-2 text-white hover:text-gray-300 justify-center align-middle",onClick:()=>navigator.clipboard.writeText(t.id.id),children:e.jsx(B,{className:"h-4 w-4"})})})})})}),e.jsx(o,{children:t.start?new Date(t.start).toLocaleString():"N/A"}),e.jsx(o,{children:b(t.balance)}),e.jsx(o,{className:"text-red-600",children:b(t.released)}),e.jsx(o,{className:"text-green-600",children:b(n)}),e.jsx(o,{children:t.duration.toFixed(2)}),e.jsx(o,{children:t.claim_interval.toFixed(5)}),e.jsx(o,{children:t.last_claimed?new Date(t.last_claimed).toLocaleString():"N/A"})]},t.id.id||a)})})]})})})]})})]})})]})})};export{Z as default};
