import{r as N,j as e,c as X,b as ge,$ as je,u as pe,d as ve,S as fe,g as be,T as ye}from"./index-iN8fCw0q.js";import{u as we,t as Ce,F as Ie,a as i,b as c,c as l,d,f as u,e as m,C as I}from"./form-BuRlPvu2.js";import{z as o}from"./index-DXqQCM1T.js";import{I as v}from"./input-DkAVD-Qy.js";import{S as E,a as B,b as D,c as F,d as p}from"./select-eqAsCXqb.js";import{c as Ne,Q as Se,B as L}from"./createLucideIcon-tKRT68xa.js";import{P as Te,a as Me,b as Pe}from"./popover-D1JqKzP9.js";import{f as ke,C as Ee}from"./calendar-6jMzA77n.js";import{a as Be}from"./axios-B4uVmeYG.js";import{S as De}from"./sidebar-dqPYJSSx.js";import"./index-BjyhK_Je.js";import"./layout-Bi5imwWd.js";import"./dropdown-menu-DEEHH6DH.js";const Fe=ge("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),W=N.forwardRef(({className:r,variant:g,size:A,asChild:s=!1,...T},V)=>{const H=s?je:"button";return e.jsx(H,{className:X(Fe({variant:g,size:A,className:r})),ref:V,...T})});W.displayName="Button";const K=(r,g)=>{switch(g){case"minutes":return r*60*1e3;case"hours":return r*60*60*1e3;case"days":return r*24*60*60*1e3;default:return r}},Ae=(r,g)=>g==="PM"&&r<12?r+12:g==="AM"&&r===12?0:r;/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=Ne("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),He=o.object({investorName:o.string().min(1,"Investor Name is required"),startDate:o.date().nullable(),startHour:o.preprocess(r=>Number(r),o.number().min(1).max(12)),startMinute:o.preprocess(r=>Number(r),o.number().min(0).max(59)),startPeriod:o.enum(["AM","PM"]),duration:o.preprocess(r=>Number(r),o.number().min(1)),durationUnit:o.enum(["minutes","hours","days"]),claimInterval:o.preprocess(r=>Number(r),o.number().min(1)),claimIntervalUnit:o.enum(["minutes","hours","days"]),receiver:o.string().min(1),amount:o.preprocess(r=>Number(r),o.number().min(1)),transferPercentage:o.preprocess(r=>Number(r),o.number().min(0).max(100)),coin:o.string().min(1)}),Ye=()=>{const r="http://localhost:8000/api",g=pe(),A=ve(),{control:s,handleSubmit:T,...V}=we({resolver:Ce(He),defaultValues:{startDate:null,startHour:1,startMinute:0,startPeriod:"AM",duration:1,durationUnit:"days",claimInterval:1,claimIntervalUnit:"days",receiver:"",amount:1,transferPercentage:0,coin:"",investorName:""}}),[H,Y]=N.useState(""),[U,Z]=N.useState([]),[Ue,ee]=N.useState(""),[te,ne]=N.useState(!1),M=new fe({url:be("testnet")});N.useEffect(()=>{g&&re(g.address)},[g]);const re=async n=>{try{const t=await M.getAllBalances({owner:n}),O=(await Promise.all(t.map(async h=>{const f=await M.getCoinMetadata({coinType:h.coinType});if(console.log("balance:",h),console.log("coinDetails:",f),console.log("balance.coinType:",h.coinType),console.log("coinType:",h.coinType),f&&f.id){const y=[];let w=null,P=null;do w=await M.getCoins({owner:n,coinType:h.coinType,limit:50,cursor:P}),y.push(...w.data),P=w.nextCursor;while(w.hasNextPage);if(console.log("Fetched coins:",y),y.length===0)return console.error(`No coin object found for coin type: ${h.coinType}`),null;const $=y[0].coinObjectId,G=Number(h.totalBalance)/Math.pow(10,f.decimals);return{coinType:h.coinType,coinObjectId:$,coinName:f.name,totalBalance:G.toString()}}return null}))).filter(h=>h!==null);Z(O)}catch(t){console.error("Failed to fetch balances:",t)}},Q=async n=>{try{console.log(`Fetching details for coin with object ID: ${n}`);const t=await M.getObject({id:n});return console.log("Fetched coin details:",t.data),t.data}catch(t){return console.error("Failed to fetch coin details:",t),null}},se=async n=>{var J;if(!g){L.error("Please connect the wallet first");return}const{startDate:t,startHour:a,startMinute:O,startPeriod:h,duration:f,durationUnit:y,claimInterval:w,claimIntervalUnit:P,receiver:$,investorName:G,amount:ae,transferPercentage:oe,coin:S}=n;if(console.log(G),console.log("Form data:",n),!t){console.error("Start date is not set");return}const ie=Ae(a,h);t.setHours(ie,O,0,0);const _=t.getTime();if(_<Date.now()){console.error("Start time is in the past");return}const ce=BigInt(ae*1e9),le=BigInt(K(f,y)),de=BigInt(K(w,P)),ue=BigInt(_),x=new ye;x.setGasBudget(1e7);const R=U.find(j=>j.coinObjectId!==S);if(console.log("Selected gas coin:",R),!R){console.error("No valid gas coin found");return}const b=await Q(R.coinObjectId);if(console.log("Gas coin details:",b),!b||!b.objectId||!b.version||!b.digest){console.error("Invalid gas coin data:",b);return}const{objectId:me,version:he,digest:xe}=b,C=await Q(S);if(console.log("Token coin details:",C),!C||!C.objectId||!C.version||!C.digest){console.error("Invalid token coin data:",C);return}const q=(J=U.find(j=>j.coinObjectId===S))==null?void 0:J.coinType;if(console.log("Selected coin type:",q),!q){console.error("Selected coin type not found");return}console.log("Coin object ID:",S),console.log("Setting gas payment with:",{objectId:me,version:he,digest:xe}),x.setGasBudget(1e7),x.moveCall({target:"0x4afa11807187e5c657ffba3b552fdbb546d6e496ee5591dca919c99dd48d3f27::torqueprotocol::entry_new",arguments:[x.object(S),x.pure(ce,"u64"),x.pure(oe,"u64"),x.object("0x0000000000000000000000000000000000000000000000000000000000000006"),x.pure(ue,"u64"),x.pure(le,"u64"),x.pure(de,"u64"),x.pure($,"address")],typeArguments:[q]});try{const j=await A.mutateAsync({transactionBlock:x,options:{showObjectChanges:!0,showEffects:!0},requestType:"WaitForLocalExecution"});console.log("Transaction result:",j),Y(j.digest),L.success("Transaction successful!");try{const k=await Be.post(`${r}/vesting/createVesting`,{...n,digest:j.digest},{headers:{"Content-Type":"application/json"}}),z=k.data;console.log("API response:",z),k.status===200?console.log("API call succeeded:",z.message):console.error("API call failed:",z.message)}catch(k){console.error("API Error:",k)}}catch(j){console.error("Transaction error:",j),L.error("Transaction failed.")}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex",children:[e.jsx(De,{isCollapsed:te,setIsCollapsed:ne}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto p-4 text-white ",children:[e.jsx(Se,{}),e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsxs("div",{className:" rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center",children:"CREATE VESTING"}),e.jsx(Ie,{...V,handleSubmit:T,control:s,children:e.jsxs("form",{onSubmit:T(se),className:"space-y-8",children:[e.jsx(i,{control:s,name:"investorName",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Enter the investor's name."}),e.jsx(d,{children:e.jsx(v,{type:"text",...n,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})}),e.jsx(u,{children:"Enter the receiver address."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"startDate",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Start Date"}),e.jsx(d,{children:e.jsxs(Te,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(W,{variant:"outline",className:X("w-[400px] pl-6 justify-start text-left font-normal",!n.value&&"text-muted-foreground"),children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),n.value?ke(n.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Pe,{className:"w-auto p-0",children:e.jsx(Ee,{mode:"single",selected:n.value||void 0,onSelect:t=>n.onChange(t),initialFocus:!0})})]})}),e.jsx(u,{children:"Select the start date for the vesting."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"startHour",render:({field:n})=>e.jsxs(e.Fragment,{children:[e.jsx(i,{control:s,name:"coin",render:({field:t})=>e.jsxs(c,{children:[e.jsx(l,{children:"Select Coin"}),e.jsx(d,{children:e.jsxs(E,{onValueChange:a=>{t.onChange(a),ee(a)},defaultValue:"",children:[e.jsx(B,{children:e.jsx(D,{placeholder:"Select a coin"})}),e.jsx(F,{children:U.map(a=>e.jsxs(p,{value:a.coinObjectId,children:[a.coinName," ","- Balance:"," ",a.totalBalance]},a.coinObjectId))})]})}),e.jsx(u,{children:"Select the coin for vesting."}),e.jsx(m,{})]})}),e.jsxs(c,{children:[e.jsx(l,{children:"Start Hour"}),e.jsx(d,{children:e.jsx(I,{name:"startHour",control:s,render:({field:t})=>e.jsx(v,{type:"number",...t,value:t.value||"",onChange:a=>t.onChange(parseInt(a.target.value,10)),min:1,max:12,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(u,{children:"Enter the start hour (1-12)."}),e.jsx(m,{})]})]})}),e.jsx(i,{control:s,name:"startPeriod",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"AM/PM"}),e.jsx(d,{children:e.jsxs(E,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(B,{children:e.jsx(D,{placeholder:"Select period"})}),e.jsxs(F,{children:[e.jsx(p,{value:"AM",children:"AM"}),e.jsx(p,{value:"PM",children:"PM"})]})]})}),e.jsx(u,{children:"Select AM or PM."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"startMinute",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Start Minute"}),e.jsx(d,{children:e.jsx(I,{name:"startMinute",control:s,render:({field:t})=>e.jsx(v,{type:"number",...t,value:t.value||"",onChange:a=>t.onChange(parseInt(a.target.value,10)),min:0,max:59,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(u,{children:"Enter the start minute (0-59)."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"duration",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Duration"}),e.jsx(d,{children:e.jsx(I,{name:"duration",control:s,render:({field:t})=>e.jsx(v,{type:"number",...t,value:t.value||"",onChange:a=>t.onChange(parseInt(a.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(u,{children:"Enter the duration of the vesting period."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"durationUnit",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Duration Unit"}),e.jsx(d,{children:e.jsxs(E,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(B,{children:e.jsx(D,{placeholder:"Select duration unit"})}),e.jsxs(F,{children:[e.jsx(p,{value:"minutes",children:"Minutes"}),e.jsx(p,{value:"hours",children:"Hours"}),e.jsx(p,{value:"days",children:"Days"})]})]})}),e.jsx(u,{children:"Select the unit of duration."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"claimInterval",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Claim Interval"}),e.jsx(d,{children:e.jsx(I,{name:"claimInterval",control:s,render:({field:t})=>e.jsx(v,{type:"number",...t,value:t.value||"",onChange:a=>t.onChange(parseInt(a.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(u,{children:"Enter the interval for claims."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"claimIntervalUnit",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Claim Interval Unit"}),e.jsx(d,{children:e.jsxs(E,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(B,{children:e.jsx(D,{placeholder:"Select interval unit"})}),e.jsxs(F,{children:[e.jsx(p,{value:"minutes",children:"Minutes"}),e.jsx(p,{value:"hours",children:"Hours"}),e.jsx(p,{value:"days",children:"Days"})]})]})}),e.jsx(u,{children:"Select the unit of the claim interval."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"receiver",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Receiver Address"}),e.jsx(d,{children:e.jsx(v,{type:"text",...n,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})}),e.jsx(u,{children:"Enter the receiver address."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"amount",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"Amount"}),e.jsx(d,{children:e.jsx(I,{name:"amount",control:s,render:({field:t})=>e.jsx(v,{type:"number",...t,value:t.value||"",onChange:a=>t.onChange(parseInt(a.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(u,{children:"Enter the amount to be vested."}),e.jsx(m,{})]})}),e.jsx(i,{control:s,name:"transferPercentage",render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{children:"TGE Percentage"}),e.jsx(d,{children:e.jsx(I,{name:"transferPercentage",control:s,render:({field:t})=>e.jsx(v,{type:"number",...t,value:t.value||"",onChange:a=>t.onChange(parseInt(a.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm",placeholder:"Enter percentage (0-100)"})})}),e.jsx(u,{children:"Enter the immediate transfer percentage (0-100)."}),e.jsx(m,{})]})}),e.jsx(W,{type:"submit",className:"bg-blue-600 text-white hover:bg-blue-700",children:"Create Vesting"}),e.jsx("div",{className:"mt-4",children:e.jsxs("p",{className:" text-gray-400 text-xs",children:["Digest: ",H]})})]})})]})})]})})]})})};export{Ye as default};
