import{u as W,b as L,S as M,g as $,r as y,j as e,T as V}from"./index-DJbGr_XK.js";import{Q as q,B as i}from"./createLucideIcon-PYH7y5E7.js";/* empty css              */import{T as G}from"./Tooltip-B8bXz2dj.js";import{T as H,a as J,b as S,c as l,d as P,e as d}from"./table-CI5DBkkK.js";import{S as Q}from"./sidebar-1jybFckO.js";import{C as U}from"./copy-DlyO-x-U.js";import"./layout-DlkItMlA.js";import"./dropdown-menu-DJDorrnO.js";import"./tooltip-7xrj6hNb.js";const oe=()=>{const f=W(),F=L(),j=new M({url:$("testnet")}),[R,E]=y.useState([]),[_,k]=y.useState(!1),T="0x4afa11807187e5c657ffba3b552fdbb546d6e496ee5591dca919c99dd48d3f27",v=async()=>{try{i.info("Fetching vesting status...");const r=(await j.getOwnedObjects({owner:(f==null?void 0:f.address)||"",filter:{StructType:`${T}::torqueprotocol::Wallet`},options:{showType:!0,showContent:!0}})).data.filter(n=>{var a;return(a=n.data)==null?void 0:a.objectId}),s=await Promise.all(r.map(async n=>{var a;try{const u=(await j.getObject({id:n.data.objectId,options:{showContent:!0}})).data;console.log("Wallet Object:",JSON.stringify(u,null,2));const c=(a=u==null?void 0:u.content)==null?void 0:a.fields,b=await B(c.id.id),o=u.content.type.match(/<(.+)>/),h=o?o[1]:null;console.log("Extracted Wallet Type:",h);const x=await j.getCoinMetadata({coinType:h}),p=(x==null?void 0:x.name)??"";return{id:{id:c.id.id},balance:Number(c.balance)/1e9,released:Number(c.released)/1e9,duration:Number(c.duration)/(24*60*60*1e3),claim_interval:Number(c.claim_interval)/(24*60*60*1e3),last_claimed:Number(c.last_claimed),start:Number(c.start),releasable:Number(b)/1e9,walletType:h,coinName:p}}catch(m){return console.log("Error fetching wallet details:",m),null}}));E(s.filter(n=>n!==null)),i.success("Vesting status fetched successfully!")}catch(t){i.error("Failed to fetch vesting status."),console.error("Failed to fetch vesting status:",t)}},B=async t=>{var r,s,n,a,m,u,c,b;try{const o=(await j.getObject({id:t,options:{showContent:!0}})).data,h=Date.now(),x=(s=(r=o==null?void 0:o.content)==null?void 0:r.fields)==null?void 0:s.start,p=(a=(n=o==null?void 0:o.content)==null?void 0:n.fields)==null?void 0:a.duration,A=(u=(m=o==null?void 0:o.content)==null?void 0:m.fields)==null?void 0:u.balance,w=(b=(c=o==null?void 0:o.content)==null?void 0:c.fields)==null?void 0:b.released;if(!x||!p||!A||!w)throw new Error("Incomplete wallet data");return C(x,p,A,w,h)}catch(N){return console.error("Failed to fetch releasable amount:",N),0}},I=t=>{const r=Date.now(),n=C(t.start,t.duration*(24*60*60*1e3),t.balance*1e9,t.released*1e9,r)-t.released*1e9;return Math.max(n,0)/1e9},C=(t,r,s,n,a)=>a<t?0:a>t+r?s+n:(s+n)*(a-t)/r,D=async(t,r)=>{try{i.info("Claiming vested amount...");const s=new V;s.setGasBudget(1e7),s.moveCall({target:`${T}::torqueprotocol::entry_claim`,arguments:[s.object(t),s.object("0x0000000000000000000000000000000000000000000000000000000000000006")],typeArguments:[r]});const n=await F.mutateAsync({transactionBlock:s,options:{showObjectChanges:!0,showEffects:!0},requestType:"WaitForLocalExecution"});if(n.effects&&n.effects.status&&n.effects.status.status==="failure"){const a=n.effects.status.error||"Transaction failed";a.includes("gas")?i.error("No Gas coin for Transaction."):a.includes("claim")?i.error("No ARTFI Coin to claim."):i.error(a)}else i.success("Transaction successful."),v()}catch(s){const n=s.message||"Transaction failed";n.includes("gas")?i.error("No Gas coin for Transaction."):n.includes("claim")?i.error("No ARTFI Coin to claim."):i.error(n),console.error("Failed to claim vested amount:",s)}};y.useEffect(()=>{f&&v()},[f]);const g=t=>(t||0).toLocaleString(void 0,{maximumFractionDigits:2}),O=t=>{if(!t)return"";const r=t.slice(0,4),s=t.slice(-5);return`${r}.....${s}`};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex",children:[e.jsx(Q,{isCollapsed:_,setIsCollapsed:k}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto p-2 pt-10  text-white",children:[e.jsx(q,{}),e.jsx("div",{className:" justify-center items-center ",children:e.jsxs("div",{className:" rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center",children:"My Vestings"}),e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(H,{className:"min-w-full  text-white",children:[e.jsx(J,{className:"",children:e.jsxs(S,{children:[e.jsx(l,{children:"Wallet ID"}),e.jsx(l,{children:"Coin Name"}),e.jsx(l,{children:"Copy ID"}),e.jsx(l,{children:"Start"}),e.jsx(l,{children:"Balance"}),e.jsx(l,{children:"Released"}),e.jsx(l,{children:"Claimable Amount"}),e.jsx(l,{children:"Duration (days)"}),e.jsx(l,{children:"Claim Interval (days)"}),e.jsx(l,{children:"Last Released"}),e.jsx(l,{children:"Action"})]})}),e.jsx(P,{children:R.map((t,r)=>{const s=I(t);return e.jsxs(S,{className:"font-bold  text-white",children:[e.jsx(d,{children:O(t.id.id)}),e.jsx(d,{children:t.coinName}),e.jsx(d,{children:e.jsx("div",{className:"flex items-center",children:e.jsx(G,{message:"Copy",children:e.jsx("div",{className:"flex items-center",children:e.jsx("button",{className:"ml-2 text-white hover:text-gray-300 justify-center align-middle",onClick:()=>navigator.clipboard.writeText(t.id.id),children:e.jsx(U,{className:"h-4 w-4"})})})})})}),e.jsx(d,{children:t.start?new Date(t.start).toLocaleString():"N/A"}),e.jsx(d,{children:g(t.balance)}),e.jsx(d,{className:"text-red-600",children:g(t.released)}),e.jsx(d,{className:"text-green-600",children:g(s)}),e.jsx(d,{children:t.duration.toFixed(2)}),e.jsx(d,{children:t.claim_interval.toFixed(5)}),e.jsx(d,{children:t.last_claimed?new Date(t.last_claimed).toLocaleString():"N/A"}),e.jsx(d,{children:e.jsx("button",{className:`bg-green-400 text-black px-4 py-2 rounded  ${s===0?"opacity-50 cursor-not-allowed":""}`,onClick:()=>D(t.id.id,t.walletType),disabled:s===0,children:"Claim Now"})})]},t.id.id||r)})})]})})})]})})]})})]})})};export{oe as default};
