import{u as xe,b as je,r as S,S as ge,g as pe,j as e,c as ve,T as be}from"./index-DJbGr_XK.js";import{u as ye,t as fe,F as Ce,a as o,b as c,c as i,d as l,f as d,e as u,C as w}from"./form-C2R2OZWO.js";import{z as a}from"./index-DXqQCM1T.js";import{B as z,a as we}from"./axios-hWXxEdE3.js";import{I as p}from"./input-COSP1Qgd.js";import{S as P,a as E,b as k,c as B,d as g}from"./select-B_9foU1Z.js";import{c as Ie,Q as Se,B as G}from"./createLucideIcon-PYH7y5E7.js";import{P as Ne,a as Te,b as Me}from"./popover-LQVu2oa5.js";import{f as Pe,C as Ee}from"./calendar-B84e2TPa.js";import{S as ke}from"./sidebar-1jybFckO.js";import"./index-5UkE9UHW.js";import"./layout-DlkItMlA.js";import"./dropdown-menu-DJDorrnO.js";import"./tooltip-7xrj6hNb.js";const Q=(n,x)=>{switch(x){case"minutes":return n*60*1e3;case"hours":return n*60*60*1e3;case"days":return n*24*60*60*1e3;default:return n}},Be=(n,x)=>x==="PM"&&n<12?n+12:x==="AM"&&n===12?0:n;/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=Ie("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),Fe=a.object({investorName:a.string().min(1,"Investor Name is required"),startDate:a.date().nullable(),startHour:a.preprocess(n=>Number(n),a.number().min(1).max(12)),startMinute:a.preprocess(n=>Number(n),a.number().min(0).max(59)),startPeriod:a.enum(["AM","PM"]),duration:a.preprocess(n=>Number(n),a.number().min(1)),durationUnit:a.enum(["minutes","hours","days"]),claimInterval:a.preprocess(n=>Number(n),a.number().min(1)),claimIntervalUnit:a.enum(["minutes","hours","days"]),receiver:a.string().min(1),amount:a.preprocess(n=>Number(n),a.number().min(1)),transferPercentage:a.preprocess(n=>Number(n),a.number().min(0).max(100)),coin:a.string().min(1)}),Je=()=>{const n="http://localhost:8000/api",x=xe(),_=je(),{control:r,handleSubmit:R,...J}=ye({resolver:fe(Fe),defaultValues:{startDate:null,startHour:1,startMinute:0,startPeriod:"AM",duration:1,durationUnit:"days",claimInterval:1,claimIntervalUnit:"days",receiver:"",amount:1,transferPercentage:0,coin:"",investorName:""}}),[K,X]=S.useState(""),[D,Y]=S.useState([]),[,Z]=S.useState(""),[ee,te]=S.useState(!1),N=new ge({url:pe("testnet")});S.useEffect(()=>{x&&se(x.address)},[x]);const se=async t=>{try{const s=await N.getAllBalances({owner:t}),F=(await Promise.all(s.map(async m=>{const v=await N.getCoinMetadata({coinType:m.coinType});if(console.log("balance:",m),console.log("coinDetails:",v),console.log("balance.coinType:",m.coinType),console.log("coinType:",m.coinType),v&&v.id){const y=[];let f=null,T=null;do f=await N.getCoins({owner:t,coinType:m.coinType,limit:50,cursor:T}),y.push(...f.data),T=f.nextCursor;while(f.hasNextPage);if(console.log("Fetched coins:",y),y.length===0)return console.error(`No coin object found for coin type: ${m.coinType}`),null;const A=y[0].coinObjectId,V=Number(m.totalBalance)/Math.pow(10,v.decimals);return{coinType:m.coinType,coinObjectId:A,coinName:v.name,totalBalance:V.toString()}}return null}))).filter(m=>m!==null);Y(F)}catch(s){console.error("Failed to fetch balances:",s)}},$=async t=>{try{console.log(`Fetching details for coin with object ID: ${t}`);const s=await N.getObject({id:t});return console.log("Fetched coin details:",s.data),s.data}catch(s){return console.error("Failed to fetch coin details:",s),null}},ne=async t=>{var W;if(!x){G.error("Please connect the wallet first");return}const{startDate:s,startHour:q,startMinute:F,startPeriod:m,duration:v,durationUnit:y,claimInterval:f,claimIntervalUnit:T,receiver:A,investorName:V,amount:re,transferPercentage:ae,coin:I}=t;if(console.log(V),console.log("Form data:",t),!s){console.error("Start date is not set");return}const oe=Be(q,m);s.setHours(oe,F,0,0);const L=s.getTime();if(L<Date.now()){console.error("Start time is in the past");return}const ce=BigInt(re*1e9),ie=BigInt(Q(v,y)),le=BigInt(Q(f,T)),de=BigInt(L),h=new be;h.setGasBudget(1e7);const H=D.find(j=>j.coinObjectId!==I);if(console.log("Selected gas coin:",H),!H){console.error("No valid gas coin found");return}const b=await $(H.coinObjectId);if(console.log("Gas coin details:",b),!b||!b.objectId||!b.version||!b.digest){console.error("Invalid gas coin data:",b);return}const{objectId:ue,version:me,digest:he}=b,C=await $(I);if(console.log("Token coin details:",C),!C||!C.objectId||!C.version||!C.digest){console.error("Invalid token coin data:",C);return}const U=(W=D.find(j=>j.coinObjectId===I))==null?void 0:W.coinType;if(console.log("Selected coin type:",U),!U){console.error("Selected coin type not found");return}console.log("Coin object ID:",I),console.log("Setting gas payment with:",{objectId:ue,version:me,digest:he}),h.setGasBudget(1e7),h.moveCall({target:"0x4afa11807187e5c657ffba3b552fdbb546d6e496ee5591dca919c99dd48d3f27::torqueprotocol::entry_new",arguments:[h.object(I),h.pure(ce,"u64"),h.pure(ae,"u64"),h.object("0x0000000000000000000000000000000000000000000000000000000000000006"),h.pure(de,"u64"),h.pure(ie,"u64"),h.pure(le,"u64"),h.pure(A,"address")],typeArguments:[U]});try{const j=await _.mutateAsync({transactionBlock:h,options:{showObjectChanges:!0,showEffects:!0},requestType:"WaitForLocalExecution"});console.log("Transaction result:",j),X(j.digest),G.success("Transaction successful!");try{const M=await we.post(`${n}/vesting/createVesting`,{...t,digest:j.digest},{headers:{"Content-Type":"application/json"}}),O=M.data;console.log("API response:",O),M.status===200?console.log("API call succeeded:",O.message):console.error("API call failed:",O.message)}catch(M){console.error("API Error:",M)}}catch(j){console.error("Transaction error:",j),G.error("Transaction failed.")}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex",children:[e.jsx(ke,{isCollapsed:ee,setIsCollapsed:te}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"container mx-auto p-4 text-white ",children:[e.jsx(Se,{}),e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsxs("div",{className:" rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4 text-center",children:"CREATE VESTING"}),e.jsx(Ce,{...J,handleSubmit:R,control:r,children:e.jsxs("form",{onSubmit:R(ne),className:"space-y-8",children:[e.jsx(o,{control:r,name:"investorName",render:({field:t})=>e.jsxs(c,{children:[e.jsx(i,{children:"Enter the investor's name."}),e.jsx(l,{children:e.jsx(p,{type:"text",...t,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})}),e.jsx(d,{children:"Enter the receiver address."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"startDate",render:({field:t})=>e.jsxs(c,{children:[e.jsx(i,{children:"Start Date"}),e.jsx(l,{children:e.jsxs(Ne,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs(z,{variant:"outline",className:ve("w-[400px] pl-6 justify-start text-left font-normal",!t.value&&"text-muted-foreground"),children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),t.value?Pe(t.value,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(Me,{className:"w-auto p-0",children:e.jsx(Ee,{mode:"single",selected:t.value||void 0,onSelect:s=>t.onChange(s),initialFocus:!0})})]})}),e.jsx(d,{children:"Select the start date for the vesting."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"startHour",render:()=>e.jsxs(e.Fragment,{children:[e.jsx(o,{control:r,name:"coin",render:({field:t})=>e.jsxs(c,{children:[e.jsx(i,{children:"Select Coin"}),e.jsx(l,{children:e.jsxs(P,{onValueChange:s=>{t.onChange(s),Z(s)},defaultValue:"",children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select a coin"})}),e.jsx(B,{children:D.map(s=>e.jsxs(g,{value:s.coinObjectId,children:[s.coinName," ","- Balance:"," ",s.totalBalance]},s.coinObjectId))})]})}),e.jsx(d,{children:"Select the coin for vesting."}),e.jsx(u,{})]})}),e.jsxs(c,{children:[e.jsx(i,{children:"Start Hour"}),e.jsx(l,{children:e.jsx(w,{name:"startHour",control:r,render:({field:t})=>e.jsx(p,{type:"number",...t,value:t.value||"",onChange:s=>t.onChange(parseInt(s.target.value,10)),min:1,max:12,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(d,{children:"Enter the start hour (1-12)."}),e.jsx(u,{})]})]})}),e.jsx(o,{control:r,name:"startPeriod",render:({field:t})=>e.jsxs(c,{children:[e.jsx(i,{children:"AM/PM"}),e.jsx(l,{children:e.jsxs(P,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select period"})}),e.jsxs(B,{children:[e.jsx(g,{value:"AM",children:"AM"}),e.jsx(g,{value:"PM",children:"PM"})]})]})}),e.jsx(d,{children:"Select AM or PM."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"startMinute",render:()=>e.jsxs(c,{children:[e.jsx(i,{children:"Start Minute"}),e.jsx(l,{children:e.jsx(w,{name:"startMinute",control:r,render:({field:t})=>e.jsx(p,{type:"number",...t,value:t.value||"",onChange:s=>t.onChange(parseInt(s.target.value,10)),min:0,max:59,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(d,{children:"Enter the start minute (0-59)."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"duration",render:()=>e.jsxs(c,{children:[e.jsx(i,{children:"Duration"}),e.jsx(l,{children:e.jsx(w,{name:"duration",control:r,render:({field:t})=>e.jsx(p,{type:"number",...t,value:t.value||"",onChange:s=>t.onChange(parseInt(s.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(d,{children:"Enter the duration of the vesting period."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"durationUnit",render:({field:t})=>e.jsxs(c,{children:[e.jsx(i,{children:"Duration Unit"}),e.jsx(l,{children:e.jsxs(P,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select duration unit"})}),e.jsxs(B,{children:[e.jsx(g,{value:"minutes",children:"Minutes"}),e.jsx(g,{value:"hours",children:"Hours"}),e.jsx(g,{value:"days",children:"Days"})]})]})}),e.jsx(d,{children:"Select the unit of duration."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"claimInterval",render:()=>e.jsxs(c,{children:[e.jsx(i,{children:"Claim Interval"}),e.jsx(l,{children:e.jsx(w,{name:"claimInterval",control:r,render:({field:t})=>e.jsx(p,{type:"number",...t,value:t.value||"",onChange:s=>t.onChange(parseInt(s.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(d,{children:"Enter the interval for claims."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"claimIntervalUnit",render:({field:t})=>e.jsxs(c,{children:[e.jsx(i,{children:"Claim Interval Unit"}),e.jsx(l,{children:e.jsxs(P,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(E,{children:e.jsx(k,{placeholder:"Select interval unit"})}),e.jsxs(B,{children:[e.jsx(g,{value:"minutes",children:"Minutes"}),e.jsx(g,{value:"hours",children:"Hours"}),e.jsx(g,{value:"days",children:"Days"})]})]})}),e.jsx(d,{children:"Select the unit of the claim interval."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"receiver",render:({field:t})=>e.jsxs(c,{children:[e.jsx(i,{children:"Receiver Address"}),e.jsx(l,{children:e.jsx(p,{type:"text",...t,className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})}),e.jsx(d,{children:"Enter the receiver address."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"amount",render:()=>e.jsxs(c,{children:[e.jsx(i,{children:"Amount"}),e.jsx(l,{children:e.jsx(w,{name:"amount",control:r,render:({field:t})=>e.jsx(p,{type:"number",...t,value:t.value||"",onChange:s=>t.onChange(parseInt(s.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm"})})}),e.jsx(d,{children:"Enter the amount to be vested."}),e.jsx(u,{})]})}),e.jsx(o,{control:r,name:"transferPercentage",render:()=>e.jsxs(c,{children:[e.jsx(i,{children:"TGE Percentage"}),e.jsx(l,{children:e.jsx(w,{name:"transferPercentage",control:r,render:({field:t})=>e.jsx(p,{type:"number",...t,value:t.value||"",onChange:s=>t.onChange(parseInt(s.target.value,10)),className:"mt-1 block w-full border-gray-600 bg-gray-700 text-white rounded-md shadow-sm",placeholder:"Enter percentage (0-100)"})})}),e.jsx(d,{children:"Enter the immediate transfer percentage (0-100)."}),e.jsx(u,{})]})}),e.jsx(z,{type:"submit",className:"bg-blue-600 text-white hover:bg-blue-700",children:"Create Vesting"}),e.jsx("div",{className:"mt-4",children:e.jsxs("p",{className:" text-gray-400 text-xs",children:["Digest: ",K]})})]})})]})})]})})]})})};export{Je as default};
